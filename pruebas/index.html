<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" type="text/css" href="css/index.css" />
    <link rel="stylesheet" type="text/css" href="lib/sweetalert2/dist/sweetalert2.min.css" />
    <link rel="stylesheet" type="text/css" href="lib/font-awesome/css/fontawesome.min.css" />
    <link rel="stylesheet" type="text/css" href="lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="lib/datatables/css/dataTables.bootstrap.min.css" />
    <title>Hello World</title>
</head>
<body> 
    <div id="header"></div>
    <div class="app"></div>
        <div class="wrapper fadeInDown">
            <div id="formContent">
                <!-- Tabs Titles -->
                <!-- Icon -->
                <div class="fadeIn first">
                    <img src="img/logo.png" id="icon" style="width:200px;" />
                </div>
                <!-- Login Form -->
                
                <input type="text"  id="user" name="user" class="textarea" placeholder = "Usuario" />     
                <input type="password" id="pass" name="pass"   class="textarea" placeholder = "Clave" />	
             
                <br/><br/>
                    <input type="button" class="fadeIn fourth btn-send" style="widows: 70px;" value="Comenzar Prueba">
                <!-- Remind Passowrd -->
            </div>
        </div>
    </div>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="lib/jquery/dist/jquery.min.js"></script>
    <script type="text/javascript" src="lib/bootstrap/dist/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="lib/font-awesome/js/fontawesome.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    <script type="text/javascript" src="lib/datatables/js/jquery.dataTables.js"></script>
    <script type="text/javascript" src="lib/datatables/dataTables.bootstrap.min.js"></script>
    <script type="text/javascript" src="js/system.js"></script>
    <script type="text/javascript">
        //app.initialize();
        $(".btn-send").on("click", function () {
            $.ajax({
                url: "https://api.estudiantevirtual.cl/login/login",
                type: 'POST',
                data:JSON.stringify({"rut":$("#user").val(), "pass":$("#pass").val()}),
                headers: {
                    "Content-Type":"application/json",
                    },
                beforeSend: function(){
                    Swal.fire({
                        title: 'Iniciando sesion',
                        html: 'Por favor espere.',
                        timer: 10000,
                        timerProgressBar: true,
                        didOpen: () => {
                            Swal.showLoading()
                            timerInterval = setInterval(() => 100)
                        }
                    })
                },
                success: function(response) {
                   // console.log(response);
                    if(response.status==1){
                        if (response.type==1){
                            localStorage["perfil"]='{"id":"'+response.perfil_id+'","rut":"'+$("#user").val()+'","nombre":"'+response.nombre+'","type":"'+response.type+'","seccion":"'+response.seccion_id+'"}';
                            window.location.href="niveles.html";               
                        }else{
                            localStorage["perfil"]='{"id":"'+response.perfil_id+'","rut":"'+$("#user").val()+'","nombre":"'+response.nombre+'","type":"'+response.type+'","seccion":"'+response.seccion_id+'"}';
                            window.location.href="asignatura.html";
                        }
                    }else{
                        Swal.fire({
                            title: "Error",
                            text: "No tiene acceso a esta prueba",
                            type: 'warning',
                            })
                        }   
                },error: function(error){
                    Swal.fire(
                    "Permisos Erroneos",
                    "Usuario y/o Contrase√±a son incorrectos",
                    "warning"
                    )
                }
            });
        });
    </script>
</body>
</html>